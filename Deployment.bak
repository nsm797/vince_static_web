#### Setup my account， seems like Under my acount it also can runs； 
vince@TS-OP03:~$ sudo salt -G "ipv4:10.66.66.90" state.sls users.vince

sudo salt -G "ipv4:10.66.66.45" state.sls users.vince
sudo salt -G "ipv4:10.66.66.46" state.sls users.jerry
sudo salt -G "ipv4:221.228.208.56" state.sls users.wangkai


##### For setting up other account . Must use "Space" instead of "Tab" ，Salt can't know tab ；
cd /srv/salt/users/;
cp any_users.sls new_users.sls
vi new_users.sls; # Change the new name .

cd ./files/sshkey
ssh-keygen;         ### Input the new account name .
mv new_users new_user.pem
mv new_users.pub new_users.pem.pub

salt -G "ipv4:221.228.208.30" state.sls users.new_user

send the key to the user via chat ;



#### Edit zampread via zlogin . impressing ! 
question1 ： 
	zlogin 到 zampread ；zampuser ； 貌似可以控制 sudo 时间 ； 果然有个 SUDOTIME；
	login with domain account ，vincent；  click "privilege" ,check the key account ,edit the time .

Steps:
	1. Added git (can't find git domain; can't ping git; can't access sso[test] ,SSO ? )
		[root@CPIC-DMP11 local]# route add -net 10.8.8.0/24 gw 0.0.0.0
			SIOCADDRT: Invalid argument
		[root@CPIC-DMP11 local]# route add -net 10.8.8.0/24 gw 10.66.66.1
	2. Added an nginx website ,setup php & nginx . (fixed php config problem)
  3. Added web root , set zampread own via zlogin (web: WOW, the way is impressing).
	4. Added host record in file. fixed step 2 . 
	... to be continued .
	 
-------------------------------------------------------
#### Update DNS 
DNS 172.22.40.250 

10.66.66.29  AZ-DNS01
10.66.66.33  AZ-DNS02

Add your record manually ### Geee ....
bind9 reload 
--------------------------------------------Rpm_build ;


#### Update rpm ；[rpmbuild] 

RPM factory :192.168.1.201 


# CASE 1 ; Edit json to here ;  大表推送，新增配置文件； 
/usr/src/zamplus-src/zamplus-data-update-server-v3/zamplus-data-update-server-v3/usr/local/data-update-server/distribute/release_robots
Took place the following keywords;
---"ab_cvr" ;
---"csv" 
--- or other things ;



# CASE 2 ; new file will added in Jira , Edit your file in the right place !
 

## Go to the dir 
/usr/src/zamplus-src/zamplus-data-update-server-v3
## mv zamplus-data-update-server-v3.tar.gz zamplus-data-update-server-v3-$date.tar.gz
## tar -zcvf zamplus-data-update-server-v3.tar.gz zamplus-data-update-server-v3
## Upload this tar.gz to packageMan ;

http://192.168.1.201:8877/deploy/   

click admin 
-search keyword （the rpm）
-Upload the file we changed; 
-Commit what you have done for the rpm ; 
-Upload ;

locate the version in jira （rpm），click it ；

click “release to unstbale repro”； 

"go to admin ****"; 

click “Sync Package” ;  

-login the server need to update rpm : 

###### The service we can bounce in page 
megatron ;
##After bouncing the service ,need to check the port ; 
netstat -an |awk '{print $4}' |grep 19800 

Robots ;
zamplus-billing-server
###### Need to bounce at server; 
######date-update ; [has 2 processed ; so we need to kill TWICE;]
ps -ef |grep "/usr/local/data-update-server/bin" |grep -v grep |grep -v task |awk '{print $2}' |while read lines;do kill -9 $lines;done
## check again
ps -ef |grep "/usr/local/data-update-server/bin" |grep -v grep |grep -v task 


----------------------Deployments on Robots servers ;
http://grafana.dev.zamplus.com:8813/#/dashboard/db/30-robots
sudo /etc/init.d/zamplus-robots restart


    1  history 
    2  cd /usr/local/robots/data/model_common/
    3  ls
    4  cat model_process.json 
    5  sudo /etc/init.d/zamplus-robots restart 
    6  curl 127.0.0.1:13089
    7  history 


    4  ls /var/crash/
    5  ll -t /var/crash/_usr_local_robots_bin_general_bidding 
    6  date
    7  tail -f /var/log/robots/log/service.all.log
    8  curl 127.0.0.1:13089
    9  netstat -an |grep 13089
   10  tail -f /var/log/robots/log/service.all.log
   
   tail -f /var/log/robots/log/service.all.log |grep -P '(ERROR|WARN|INIT)'

vxp

   tail -f /var/log/robots/log/service.all.log |grep "success initialized" 



--------------------------------------------------
Initialize Microsoft cloud servers : Virtual Servers . 

{
### Edit azure.info , replace with following ones.
10.66.66.29  AZ-DNS01
10.66.66.33  AZ-DNS02

### The script init_azure.py include following message. some time need to replace .
User:azureuser
Pwd:AdaG(sVa4A3

### Run it as sudo ? yeah ,I think . 
fab -f init_azure.py  init_salt
}


-------------------------------------------------------清理素材
under root
172.22.56.7
supervisorctl stop merchant_task merchant_task_monitor merchant_task_schd
ps -ef | grep merchant_task ## almost not stop ， using the following ways；
ps -ef |grep merchant_task |grep -v grep |awk '{print $2}' |xargs kill -9 
ps -ef |grep merchant_task

172.22.57.33
supervisorctl stop merchant_task
ps -ef | grep merchant_task 

2.
172.22.56.7
redis-cli
flushall

3.start
172.22.56.7
supervisorctl start merchant_task merchant_task_monitor merchant_task_schd

# supervisorctl status |tail -n 3 ### 验证启动即可；
merchant_task                    RUNNING   pid 31687, uptime 0:01:30
merchant_task_monitor            RUNNING   pid 31694, uptime 0:01:28
merchant_task_schd               RUNNING   pid 31753, uptime 0:01:27

172.22.57.33
supervisorctl start merchant_task
-----------------------------------------------------------



PostThinging . 
	像在K机器呢！ 把我们的服务器 配置，环境变量 自动 弄入新服务器：
	引用了azure.info (IP VS hostname)
	python脚本； 定义了account & pd ，maybe need to change it ； 
	
执行：
修改azure.info 为你需要的信息； 
按需求编辑 脚本 中的 account & pd ；
执行：
fab -f init_azure.py  init_salt

扩展：
还有可能来做其他云服务器的脚本；

深入；
	可以查看init_azure.py如何编写， 如何引用，查看常用模块； 如何引用salt ； 

困难：
	查询模块吧，有可能 知道如何工作 却自己写不出来；    
	

