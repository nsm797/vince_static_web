#### Setup my account， seems like Under my acount it also can runs； 
vince@TS-OP03:~$ sudo salt -G "ipv4:10.66.66.90" state.sls users.vince

sudo salt -G "ipv4:10.66.66.62" state.sls users.vince
sudo salt -G "ipv4:172.22.25.34" state.sls users.vince
sudo salt -G "ipv4:221.228.208.56" state.sls users.wangkai


##### For setting up other account . Must use "Space" instead of "Tab" ，Salt can't know tab ；
cd /srv/salt/users/;
cp any_users.sls new_users.sls
vi new_users.sls; # Change the new name .

cd ./files/sshkey
ssh-keygen;         ### Input the new account name .
mv new_users new_user.pem
mv new_users.pub new_users.pem.pub

salt -G "ipv4:221.228.208.30" state.sls users.new_user

send the key to the user via chat ;



#### Edit zampread via zlogin . impressing ! 
question1 ： 
	zlogin 到 zampread ；zampuser ； 貌似可以控制 sudo 时间 ； 果然有个 SUDOTIME；
	login with domain account ，vincent；  click "privilege" ,check the key account ,edit the time .

Steps:
	1. Added git (can't find git domain; can't ping git; can't access sso[test] ,SSO ? )
		[root@CPIC-DMP11 local]# route add -net 10.8.8.0/24 gw 0.0.0.0
			SIOCADDRT: Invalid argument
		[root@CPIC-DMP11 local]# route add -net 10.8.8.0/24 gw 10.66.66.1
	2. Added an nginx website ,setup php & nginx . (fixed php config problem)
  3. Added web root , set zampread own via zlogin (web: WOW, the way is impressing).
	4. Added host record in file. fixed step 2 . 
	... to be continued .
	 
-------------------------------------------------------
#### Update DNS 
DNS 172.22.40.250 

10.66.66.29  AZ-DNS01
10.66.66.33  AZ-DNS02

Add your record manually ### Geee ....
bind9 reload 
--------------------------------------------Rpm_build ;


#### Update rpm ；[rpmbuild] 

RPM factory :192.168.1.201 


# CASE 1 ; Edit json to here ;  大表推送，新增配置文件； 
/usr/src/zamplus-src/zamplus-data-update-server-v3/zamplus-data-update-server-v3/usr/local/data-update-server/distribute/release_robots
Took place the following keywords;
---"ab_cvr" ;
---"csv" 
--- or other things ;



# CASE 2 ; new file will added in Jira , Edit your file in the right place !
 

## Go to the dir 
/usr/src/zamplus-src/zamplus-data-update-server-v3
## mv zamplus-data-update-server-v3.tar.gz zamplus-data-update-server-v3-$date.tar.gz
## tar -zcvf zamplus-data-update-server-v3.tar.gz zamplus-data-update-server-v3
## Upload this tar.gz to packageMan ;

http://192.168.1.201:8877/deploy/   

click admin 
-search keyword （the rpm）
-Upload the file we changed; 
-Commit what you have done for the rpm ; 
-Upload ;

locate the version in jira （rpm），click it ；

click “release to unstbale repro”； 

"go to admin ****"; 

click “Sync Package” ;  

-login the server need to update rpm : 

###### The service we can bounce in page 

#############megatron ;
##After bouncing the service ,need to check the port ; 
for i in `cat mega_baidu`;do echo $i;nc -n -v -w 1 $i 19800;done

$ cat mega_baidu 
172.22.56.21
172.22.57.26
172.22.57.27
172.22.57.28
172.22.57.73
172.22.48.11
172.22.57.74
172.22.57.75

vince@TS-OP03:~/tmp$ cat mega_sina 
172.22.57.24
172.22.57.25
172.22.57.58
172.22.57.71

$ more mega_tanx 
172.22.56.1
172.22.57.22
172.22.57.23
172.22.57.40

172.22.57.48
172.22.48.9
172.22.57.55

172.22.57.71
172.22.57.62
172.22.57.61

$ cat megatron |grep 10
10.77.77.7
10.77.77.8
10.77.77.42
10.77.77.52


for i in 172.22.57.24 172.22.56.21;do echo $i;ssh $i "nc -n -v -w 1 $i 19800";done




Robots ;
zamplus-billing-server
###### Need to bounce at server; 
######date-update ; [has 2 processed ; so we need to kill TWICE;]
ps -ef |grep "/usr/local/data-update-server/bin" |grep -v grep |grep -v task |awk '{print $2}' |while read lines;do kill -9 $lines;done
## check again
ps -ef |grep "/usr/local/data-update-server/bin" |grep -v grep |grep -v task 


----------------------Deployments on Robots servers ;
http://grafana.dev.zamplus.com:8813/#/dashboard/db/30-robots
sudo /etc/init.d/zamplus-robots restart


----------------------Azure VM安装过程 ；
## 登录Azure 云 
## OS ：centOS 6.7
## CPU : A7 ； as other vms ；
## acount ： you know ； close ssh key ； input passwd ；  
## 为了精确费用 ； 填写以下项目
云 cpic
账户 azureCpic  
## Set up


------Azure
云 azure-cpic-d；
cpichosts 
Maybe we need to update wiki . 
http://wiki.dev.zamplus.com/display/OPTeam/Azure+CloudServer

cloud： az-public01

10.66.66.59 AZ-ListTest01 
10.66.66.60 AZ-ListTest02 
10.66.66.61 AZ-ListTest03 
Account:app

-------------------------Disk clean ；
## 可清理 今天之外的文件 ； 
/var/log/data_update/private/data/temp/anti_fraud  

-------------------------Disk 2  清理一些备份释放空间；

TS-OP02## 172.22.40.2 /dev/sdj        1.8T  1.6T  159G  91% /var/sdj
225505528	/var/sdj/172.22.57.1/mysql_bin_backup
416195292	/var/sdj/172.22.57.1
591021724	/var/sdj/172.22.24.33/redis_backup
591021728	/var/sdj/172.22.24.33
1659186956	/var/sdj/

root@TS-OP02:/var/sdj/172.22.24.33/redis_backup# du -sh * |head -n 30 |awk '{print $2}' |while read lines;do rm -r $lines;done
-----------------------------DIsk 3
###KafKa write too much data to the system . 
 
/dev/sdc       1007G  864G   93G  91% /opt/amos   # du -sh /opt/amos/data/kafka-logs
747G	/opt/amos/data/kafka-logs  

-----------------------------------

    1  history 
    2  cd /usr/local/robots/data/model_common/
    3  ls
    4  cat model_process.json 
    5  sudo /etc/init.d/zamplus-robots restart 
    6  curl 127.0.0.1:13089
    7  history 


    4  ls /var/crash/
    5  ll -t /var/crash/_usr_local_robots_bin_general_bidding 
    6  date
    7  tail -f /var/log/robots/log/service.all.log
    8  curl 127.0.0.1:13089
    9  netstat -an |grep 13089
   10  tail -f /var/log/robots/log/service.all.log
   
   tail -f /var/log/robots/log/service.all.log |grep -P '(ERROR|WARN|INIT)'

vxp

   tail -f /var/log/robots/log/service.all.log |grep "success initialized" 



--------------------------------------------------Ubuntu 初始化
Initialize Microsoft cloud servers : Virtual Servers . 

{
### Edit azure.info , replace with following ones.
10.66.66.29  AZ-DNS01
10.66.66.33  AZ-DNS02

### The script init_azure.py include following message. some time need to replace .
User:azureuser
Pwd:AdaG(sVa4A3

### Run it as sudo ? yeah ,I think . 
fab -f init_azure.py  init_salt
}


-------------------------------------------------------清理素材
under root
172.22.56.7
supervisorctl stop merchant_task merchant_task_monitor merchant_task_schd
ps -ef | grep merchant_task ## almost not stop ， using the following ways；
ps -ef |grep merchant_task |grep -v grep |awk '{print $2}' |xargs kill -9 
ps -ef |grep merchant_task

172.22.57.33
supervisorctl stop merchant_task
ps -ef | grep merchant_task 

2.
172.22.56.7
redis-cli
flushall

3.start
172.22.56.7
supervisorctl start merchant_task merchant_task_monitor merchant_task_schd

# supervisorctl status |tail -n 3 ### 验证启动即可；
merchant_task                    RUNNING   pid 31687, uptime 0:01:30
merchant_task_monitor            RUNNING   pid 31694, uptime 0:01:28
merchant_task_schd               RUNNING   pid 31753, uptime 0:01:27

172.22.57.33
supervisorctl start merchant_task
------------------------------
CenOS 初始化 init-----------------------------
[root@CPIC-DMP01 init_centos]#  pwd
/root/init_centos
[root@CPIC-DMP01 init_centos]# ls
epel-release-6-8.noarch.rpm  init_centos.sh  jdk-7u79-linux-x64.gz  rpmforge-release-0.5.2-2.el6.rf.x86_64.rpm
------------------------------
###  NGINX Proxy add ;  here is the list ;
http://wiki.dev.zamplus.com/pages/viewpage.action?pageId=13764728
-- conf file is under  ... ... 
/etc/nginx/sites-enabled
-----------------------------------For Adding new moniter Grafana
Click First Graph; -- edit ; -- select "opt" ; select "metric" you already defined ;


#### And we will got 3 record in the logfiles;
{"data":[{"k":"CPIC-DMP06.amos-hub-mob.MesssageInCount","v":3563545},{"k":"CPIC-DMP06.amos-hub-mob.MesssageInPerSec","v":59},{"k":"CPIC-DMP06.amos-hub-conv.MesssageInCount","v":156716},{"k":"CPIC-DMP06.amos-hub-dm.MesssageInCount","v":59759596},{"k":"CPIC-DMP06.amos-hub-dm.MesssageInPerSec","v":1176},{"k":"CPIC-DMP06.amos-hub-cm.MesssageInPerSec","v":0},{"k":"CPIC-DMP06.amos-hub-cm.MesssageInCount","v":0},{"k":"CPIC-DMP06.amos-hub-conv.MesssageInPerSec","v":5},{"k":"CPIC-DMP06.amos-hub-di.MesssageInCount","v":43400150},{"k":"CPIC-DMP06.amos-hub-di.MesssageInPerSec","v":807}],"name":"kafkaperf","namespace":"opt","time":"2016-01-12 14:54:06"}
{"data":[{"k":"CPIC-DMP08.amos-hub-cm.MesssageInPerSec","v":0},{"k":"CPIC-DMP08.amos-hub-mob.MesssageInCount","v":3379047},{"k":"CPIC-DMP08.amos-hub-dm.MesssageInPerSec","v":1176},{"k":"CPIC-DMP08.amos-hub-conv.MesssageInCount","v":161799},{"k":"CPIC-DMP08.amos-hub-cm.MesssageInCount","v":0},{"k":"CPIC-DMP08.amos-hub-dm.MesssageInCount","v":56507624},{"k":"CPIC-DMP08.amos-hub-conv.MesssageInPerSec","v":5},{"k":"CPIC-DMP08.amos-hub-mob.MesssageInPerSec","v":59},{"k":"CPIC-DMP08.amos-hub-di.MesssageInPerSec","v":801},{"k":"CPIC-DMP08.amos-hub-di.MesssageInCount","v":41308906}],"name":"kafkaperf","namespace":"opt","time":"2016-01-12 14:54:06"}
{"data":[{"k":"CPIC-DMP07.amos-hub-mob.MesssageInPerSec","v":60},{"k":"CPIC-DMP07.amos-hub-cm.MesssageInCount","v":0},{"k":"CPIC-DMP07.amos-hub-di.MesssageInPerSec","v":808},{"k":"CPIC-DMP07.amos-hub-conv.MesssageInPerSec","v":5},{"k":"CPIC-DMP07.amos-hub-conv.MesssageInCount","v":161926},{"k":"CPIC-DMP07.amos-hub-cm.MesssageInPerSec","v":0},{"k":"CPIC-DMP07.amos-hub-dm.MesssageInPerSec","v":1176},{"k":"CPIC-DMP07.amos-hub-di.MesssageInCount","v":41029397},{"k":"CPIC-DMP07.amos-hub-mob.MesssageInCount","v":3376689},{"k":"CPIC-DMP07.amos-hub-dm.MesssageInCount","v":56157165}],"name":"kafkaperf","namespace":"opt","time":"2016-01-12 14:54:06"}


PostThinging . 
	像在K机器呢！ 把我们的服务器 配置，环境变量 自动 弄入新服务器：
	引用了azure.info (IP VS hostname)
	python脚本； 定义了account & pd ，maybe need to change it ； 
	
执行：
修改azure.info 为你需要的信息； 
按需求编辑 脚本 中的 account & pd ；
执行：
fab -f init_azure.py  init_salt

扩展：
还有可能来做其他云服务器的脚本；

深入；
	可以查看init_azure.py如何编写， 如何引用，查看常用模块； 如何引用salt ； 

困难：
	查询模块吧，有可能 知道如何工作 却自己写不出来；    
	

